#Team 1: Charles, Even, Muskan, Nick

#Load 
#Activating required packages (have to be pre-installed using instal.packages('') function)
library(quantmod)
library(xts)
library(zoo)
library(PerformanceAnalytics)
library(dplyr)

#Looping throw each row to remove missing values
data1 <- data[rowSums(is.na(data)) == 0,]

memory.limit(size=16384)
#Aggregate each stock by month
data2 <- aggregate(data1[,c(4,5)], by = list(Date = as.yearmon(data1$date), Permno = data1$permno), mean)

#Loading ME breakpoints
me_breakpoints <- read.csv('ME_Breakpoints.csv')

#Converting characters into a date in two steps

me_breakpoints$X192512 <- as.character(me_breakpoints$X192512)
me_breakpoints$X192512 <- as.yearmon(me_breakpoints$X192512, format =  "%Y%m")

#Cutting relevants dates
relevant_dates <- me_breakpoints[769:1068, c(1,12)]
colnames(relevant_dates) <- c("Date", "ME NYSE Breakpoints")
relevant_dates$`ME NYSE Breakpoints` <- relevant_dates[,2] * 1000000

#Merging ME breakpoints and data2
data3 <- merge(data2, relevant_dates, by = "Date")

#top50portfolio = c()
#bottom50portfolio = c()

data3 <- data3[order(data3$Permno),]

data3["Returns"] <- NA

for (row in 2:nrow(data3)) {
  if (data3[row, 'Permno'] == data3[row - 1, 'Permno']) {
    data3[row, 'Returns'] = 100 * (data3[row, 'price'] - data3[row - 1, 'price'])/data3[row -1, "price"]
  } else {
    next
  }
}



#Denotation: J - period in months, K - holding period in months

#Step 1: Portfolio construction

#Create two subsamples using top and bottom 50% ME

#Use J=12 months formation period to create decile portfolios

#Buy winners and sell loosers, hold for K=1 months

#Roll the window by 1 month and repeat
